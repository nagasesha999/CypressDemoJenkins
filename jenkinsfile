pipeline {
    agent any
parameters {
  choice choices: ['SET1', 'SET2'], name: 'Section'
   checkboxParameter(name: 'Section', format: 'JSON',
            pipelineSubmitContent: '{"CheckboxParameter": [{"key": "SET1","value": "**/1-getting-started/*.cy.js"},{"key": "SET2","value": "**/2-advanced-examples/*.cy.js"}]}', description: '')
  
}

    // options {
    //     copyArtifactPermission 'cypresspractice'
    // }

    stages {
        stage('Install Dependencies') {
            steps {
               bat 'npm install'
            }
        }
        stage('Execute Test') {
            steps {
                   catchError(stageResult: 'FAILURE'){
                bat 'npx cypress run --spec %Section%'
                }            
            }
        }
        stage('Publish Report') {
            steps {
                publishHTML([allowMissing: false, alwaysLinkToLastBuild: false, keepAll: true, reportDir: 'cypress/reports', reportFiles: 'index.html', reportName: 'HTML Report', reportTitles: ''])
            }
        }
        stage('Archive Artifacts') {
            steps{
                archiveArtifacts artifacts: 'cypress/reports/html/index.html', followSymlinks: false
            }
        }
       
    //    stage('Copy Artifacts'){
    //       steps{
    //           script {
    //               step ([$class: 'CopyArtifact',
    //                 projectName: 'cypresspractice',
    //                 selector:specific("$BUILD_NUMBER"),
    //                 filter: "**/index.html",
    //                 target: 'c:/Archeived_Reports/$BUILD_NUMBER/$BUILD_TIMESTAMP'
    //                 ]);
    //           }
    //       }
    //    }
       
    } 
}
